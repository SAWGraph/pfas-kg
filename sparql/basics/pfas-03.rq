# Get a count of how many samplepoints from a specific set of S2 cells (here cells with plastics manufacturers) have been tested for each substance 
# This does not require access to the Spatial graph

PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>

PREFIX spatial: <http://purl.org/spatialai/spatial/spatial-full#>
PREFIX kwg-ont: <http://stko-kwg.geog.ucsb.edu/lod/ontology/>
PREFIX kwgr: <http://stko-kwg.geog.ucsb.edu/lod/resource/>
PREFIX coso: <http://w3id.org/coso/v1/contaminoso#>

SELECT DISTINCT ?substance (COUNT (DISTINCT ?sp) as ?no_samplepoints) WHERE {
  ?observation rdf:type coso:ContaminantObservation;
    	coso:observedAtSamplePoint ?sp;
    	coso:ofSubstance ?substance .
    ?sp rdf:type coso:SamplePoint; 
      spatial:connectedTo ?s2cell.
     VALUES ?s2cell {kwgr:s2.level13.5526502181185781760 kwgr:s2.level13.5526654257387798528 kwgr:s2.level13.5525241453665583104 kwgr:s2.level13.5526677690729365504 kwgr:s2.level13.5526660682658873344 kwgr:s2.level13.5526659411348553728 kwgr:s2.level13.5526649137786781696 kwgr:s2.level13.5526701502028054528 kwgr:s2.level13.5526671128019337216 kwgr:s2.level13.5526601309030973440 kwgr:s2.level13.5526595845832572928 kwgr:s2.level13.5526646148489543680 kwgr:s2.level13.5529487561413623808 kwgr:s2.level13.5526597666898706432 kwgr:s2.level13.5526675388626894848 kwgr:s2.level13.5526481599702499328 kwgr:s2.level13.5526677862528057344 kwgr:s2.level13.5525434349236781056 kwgr:s2.level13.5526344435626934272 kwgr:s2.level13.5526661541652332544 kwgr:s2.level13.5526594677601468416 kwgr:s2.level13.5526598594611642368 kwgr:s2.level13.5526612338506989568 kwgr:s2.level13.5525732007650263040 kwgr:s2.level13.5526340896573882368 kwgr:s2.level13.5525476783513665536 kwgr:s2.level13.5526638658066579456 kwgr:s2.level13.5526649962420502528 kwgr:s2.level13.5526595192997543936 kwgr:s2.level13.5525232520133607424}
} GROUP BY ?substance ORDER BY DESC(?no_samplepoints)